<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" xmlns:th="http://www.thymeleaf.org">
    <title>Devices</title>
    <link th:href="@{/css/main.css}" rel="stylesheet"/>
    <script type="text/javascript" th:src="@{/js/main.js}" defer></script>
</head>
<body>
<main>
    <div>
        <form th:action="@{/devices}" th:object="${newDevice}" method="post">
            <label>Įrenginio ID:
                <input type="text" th:field="*{deviceId}" required/>
            </label>
            <label>Transporto numeris:
                <input type="text" th:field="*{transportNr}"/>
            </label>
            <label>Komentaras:
                <input type="text" th:field="*{comment}"/>
            </label>
            <input value="Pridėti" type="submit"/>
        </form>
    </div>
    <hr>
    <table class="tb">
        <tr>
            <th>id</th>
            <th>irenginio id</th>
            <th>transporto numeris</th>
            <th>komentaras</th>
            <th>data</th>
            <th>kliento id</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr th:each="device: *{devices}">
            <td th:text="${device.id}"></td>
            <td th:text="${device.deviceId}"></td>
            <td th:text="${device.transportNr}"></td>
            <td th:text="${device.comment}"></td>
            <td th:text="${device.createDate}"></td>
            <td th:text="${device.userId}"></td>
            <td><button th:id="${device.id}" onclick="alert('Redaguoti id: ' + id)">Redaguoti</button></td>
<!--            <td><button th:id="${device.id}" onclick="deleteDevice(this.id)">Ištrinti</button></td>-->
            <td>
                <form th:action="@{/devices/delete}"  method="post">
                    <input type="hidden" th:name = "id" th:value = "${device.id}" />
                    <input value="Ištrinti" type="submit"/>
                </form>
            </td>
<!--            <td><button th:id="${device.deviceId}" onclick="openMonitoringOnButtonClick(this.id)">Stebėti</button></td>-->
            <td>
                <form th:action="@{/monitoring/run}"  method="get">
                    <input type="hidden" th:name = "deviceId" th:value = "${device.deviceId}" />
                    <input value="Stebėti" type="submit"/>
                </form>
            </td>
        </tr>
    </table>
</main>

<!--<script type="text/javascript">-->
<!--    function openMonitoringOnButtonClick(id){-->
<!--        let url = window.location.pathname;-->
<!--        let splitURL = url.split("/")[0];-->
<!--        url = splitURL + '/monitoring/' + id;-->
<!--        window.open(`${url}`, '_self');-->
<!--        $.ajax({-->
<!--            url: url,-->
<!--            type: 'POST',-->
<!--        })-->
<!--    }-->
<!--</script>-->

<script type="text/javascript">
    function deleteDevice(id){
        let url = window.location.pathname;
        let splitURL = url.split("/")[0];
        url = splitURL + '/devices/delete/' + id;
        window.open(`${url}`, '_self');
        $.ajax({
            url: url,
            type: 'DELETE',
        })
    }
</script>

</body>
</html>